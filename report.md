# Project Title
自然场景渲染

# Team member

| 学号    | 姓名   |
| ------- | ------ |
| 1950483 | 謝子康 |
| 1950638 | 陈冠忠 |
| 1951042 | 王远洋 |
| 1951125 | 农烨   |
| 1952217 | 孙泽凯 |
| 1952704 | 王麒斌 |

# Motivation

计算机图形学在众多领域有广泛的应用。其中，室外场景渲染是图形学重要的研究课题，也是3D图形引擎的核心。本小组紧扣课程所教内容，尝试充分运用渲染知识，针对一个较为复杂的场景，进行真实美观的渲染。

场景的选择中，自然场景较社会场景具有普遍性，因此成为本组的项目目标。自动场景纷繁复杂，水体、光照、云、树木等物体颇多。本组尝试对其部分景物实现建模与渲染。

# The Goal of the project

1. 导入复杂的露天场景，包含水面、动态光源、物理天空；
2. 实现PBR渲染流程与延迟渲染；
3. 实现动态水面渲染；
4. 采用多种程序方式增强画面表现力，包括HDR、Bloom、SSAO、FXAA等；
5. 采用多种美术方式增强画面表现力，如烘焙法线贴图、PBR贴图；
6. 采用基于Ray-marching的体积渲染，实现体积光、体积云等效果。

# The Scope of the project

1. 包含粒子系统的环境，包含火焰、雪等；
2. 更加复杂的PBR效果，如IBL等;
3. 水面的反射折射效果；
4. 更多增强画面表现力的方式，如镜头光晕；
5. 阴影实现部分尝试使用VSM等更高效的软阴影。

# Involved CG techniques


1. 延迟渲染 + SSAO
    为了实现更好的模型加载效果，尤其是对于模型褶皱、孔洞和非常靠近的墙面变暗的方法近似模拟出间接光照，引入了屏幕空间环境光遮蔽（SSAO）技术。由于SSAO与延迟渲染完美兼容，因此，在延迟着色的基础之上引入SSAO技术。通过G缓冲获取几何体的信息，通过法向半球以及随机核心转动的采样计算SSAO，并且添加环境遮蔽模糊为呈现更好的视觉效果，以此实现SSAO效果。

2. 体积光
    模拟自然环境，体积光自然是必不可少的效果。自然场景中的烟、雾、光、云等产生的效果可以通过图形学的方式来实现。体积光的实现采用着色器绘制的方式，即在着色器中计算体积光的光路效果。本次使用的是Ray-Match的方式来实现体积光，通过采样步长来计算效果。为了模拟太阳光这样的光源的效果，加入大气散射的效果，即Mie散射，计算的公式如下：
    $$
    f_{HG}(\theta)=\frac{(1-g)^2}{4\pi (1+g^2-2g\cdot cos(\theta))^{3/2}}
    $$

3. PBR渲染
    PBR基于物理的渲染采用粗糙度与金属度作为输入，使用更复杂的BRDF模型，能够提供更为真实的光照效果。程序采用经典的Cook-Torrance反射率方程实现PBR，并支持导入由Bitmap2Material软件生成
的粗糙度贴图提供更加精细的粗糙度输入。

4. 阴影
    程序使用shadow mapping技术实现阴影，包含了基本的定向光阴影和基于立方体贴图的点光源阴影，并使用PCF实现软阴影。
    
5. 后处理效果
    使用多种后处理效果提升画面表现力：
    ①HDR：主渲染阶段在高动态范围内完成，在后期处理阶段中，使用Reinhard色调映射映射回低动态范围，从而保留更多的明暗信息。
    ②辉光：在HDR技术的基础上，在主渲染阶段保存渲染结果中高亮度的部分，经过多次两步高斯模糊后，在后期处理阶段中与原渲染结果混合。程序采用双线性纹理的方式加速高斯模糊，并可在后期处理着色器中通过设定系数的方式调整两种不同效果的混合方式的强度，来调整辉光的具体效果。
    ③FXAA：受制于延迟渲染的特性，无法使用MSAA完成抗锯齿工作，因此采用基于后处理的FXAA技术完成抗锯齿。FXAA通过NVIDIA提供的公式工作，原理是在渲染完成后的屏幕图像中，通过像素颜色检测边缘，并由此完成不同程度的模糊完成抗锯齿。
    ④景深：主流渲染软件均提供景深效果用于模拟摄像机焦距以强调目标，本程序同样设计了简单的景深流程以削弱天空背景与场景间的对立感。在主渲染阶段中将片段(像素)的相机坐标系深度通过a通道传递到后期处理阶段。在后期处理阶段，根据a通道的值，对不同深度的像素进行不同范围的简单线性平均，并通过简单深度差值过滤的方式防止不同深度的物体颜色出现混合。为提高速度，根据实际渲染需要，景深与FXAA不同时进行。



# Project contents

# Implementation

# Result

# Roles in group

# References
[1] [learnopengl](https://learnopengl.com/)
[2] [volume light rendering](https://stackoverflow.com/questions/65784612/volumetric-light-not-rendering-volume-correctly)
[3] [体积光效果实现](https://blog.csdn.net/ZJU_fish1996/article/details/87533029)
